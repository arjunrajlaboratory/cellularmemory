sampleSCTable <-
as_tibble(read.table(paste0(homeDirectory, sampleFolders[i]), stringsAsFactors = F)) %>% dplyr::rename(BC = V1, UMI = V2) %>%
rowwise() %>% mutate(BC = reverseComplement(BC, case = "as is")) %>% ungroup() %>%
mutate(BC50 = substring(BC, 1, 50), BC40 = substring(BC, 1, 40), BC30a = substring(BC, 1, 30), BC30b = substring(BC, 1, 30)) %>%
mutate(sampleNum = sampleNames[i])
sampleSCTables[[i]] <- sampleSCTable
}
sampleSCTableAll <- list()
#concatenate all sample tables into a single experiment table to feed into starcode
for(i in 1:length(sampleFolders)) {
sampleSCTableTemp = sampleSCTables[[i]] %>% mutate(sampleNum = sampleNames[i])
if (is.null(dim(sampleSCTableAll))) {sampleSCTableAll = sampleSCTableTemp}
else {sampleSCTableAll = bind_rows(sampleSCTableAll, sampleSCTableTemp)}
}
#reformat the columns into the format expected by the side reaction pipeine
sampleSCTableAll <- sampleSCTableAll %>% add_column(cellID = "dummy", .before = "BC")
sampleSCTableAll <- sampleSCTableAll %>% relocate(UMI, .before = BC)
sampleSCTableAll$UMI <- as.character(sampleSCTableAll$UMI)
write.table(sampleSCTableAll, file= paste0(outputDirectory,'stepTwoCellIDUMIBarcodes.txt'),row.names=F,col.names=T,quote=F,sep="\t")
write.table(sampleSCTableAll[,4], file= paste0(outputDirectory,'stepTwoBarcodes50.txt'),row.names=F,col.names=F,quote=F,sep="\t")
write.table(sampleSCTableAll[,5], file= paste0(outputDirectory,'stepTwoBarcodes40.txt'),row.names=F,col.names=F,quote=F,sep="\t")
write.table(sampleSCTableAll[,6], file= paste0(outputDirectory,'stepTwoBarcodes30.txt'),row.names=F,col.names=F,quote=F,sep="\t")
#for checking LV distance histogram for an individual sample
barcodes = unique(sampleSCTableAll$BC)
set.seed(2059)
subsample1 = sample(barcodes, 1000)
subsample2 = sample(barcodes, 1000)
subsample3 = sample(barcodes, 1000)
BarcodesLv1 = as.integer(stringdistmatrix(subsample1, method = "lv"))
BarcodesLv2 = as.integer(stringdistmatrix(subsample2, method = "lv"))
BarcodesLv3 = as.integer(stringdistmatrix(subsample3, method = "lv"))
lBarcodesLv = length(BarcodesLv1)
BarcodesLv = tibble(
lvdist = c(BarcodesLv1, BarcodesLv2, BarcodesLv3),
subsamNum = c(rep("subsamping1", lBarcodesLv), rep("subsamping2", lBarcodesLv), rep("subsamping3", lBarcodesLv)))
BarcodesLvHist <- BarcodesLv %>% group_by(subsamNum, lvdist) %>% summarise(length(lvdist)) %>%
group_by(subsamNum) %>% mutate(totalNum = sum(`length(lvdist)`), fracLvDist = `length(lvdist)`/totalNum)
BarcodesLvHistPlot <- ggplot(BarcodesLvHist, aes(lvdist, fracLvDist)) +
geom_bar(width = 0.5, stat = 'identity') +
facet_wrap(facets = vars(subsamNum)) +
theme_classic()
ggsave(filename = paste0(outputDirectory, "lvDistancePlot.pdf"), plot = BarcodesLvHistPlot, height = 5, width = 5)
#use bc40 for overlap analysis
barcode_data <- sampleSCTableAll[,c(2,5,8)]
condition_names <- unique(barcode_data$sampleNum)
overlap_results <- map(condition_names, function(cond1) {
map_df(setdiff(condition_names, cond1), function(cond2) {
common_barcodes <- intersect(
barcode_data$BC40[barcode_data$sampleNum == cond1],
barcode_data$BC40[barcode_data$sampleNum == cond2]
)
unique_barcodes_cond1 <- setdiff(
barcode_data$BC40[barcode_data$sampleNum == cond1],
common_barcodes
)
unique_barcodes_cond2 <- setdiff(
barcode_data$BC40[barcode_data$sampleNum == cond2],
common_barcodes
)
tibble(
Condition1 = cond1,
Condition2 = cond2,
OverlappingBarcodes = common_barcodes,
NumOverlappingBarcodes = length(common_barcodes),
NumUniqueBarcodesCondition1 = length(unique_barcodes_cond1),
NumUniqueBarcodesCondition2 = length(unique_barcodes_cond2)
)
})
})
# Flatten the results into a single data frame
overlap_results <- bind_rows(overlap_results)
ggplot(overlap_results, aes(x = Condition1, y = NumOverlappingBarcodes, fill = Condition2)) +
geom_bar(stat = "identity", position = "dodge") +
labs(title = "Number of Overlapping Barcodes", x = "Condition 1", y = "Number of Barcodes") +
theme_minimal()
ggplot(overlap_results, aes(x = Condition1, y = NumUniqueBarcodesCondition2, fill = Condition2)) +
geom_bar(stat = "identity", position = "dodge") +
labs(title = "Number of Unique Barcodes in Condition 2", x = "Condition 1", y = "Number of Barcodes") +
theme_minimal()
ggplot(overlap_results, aes(x = Condition1, y = Condition2, fill = NumOverlappingBarcodes)) +
geom_tile() +
labs(title = "Heatmap of Overlapping Barcodes", x = "Condition 1", y = "Condition 2", fill = "Number of Barcodes") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
write.table(overlap_results, file= paste0(outputDirectory,'overlap_result.txt'),row.names=F,col.names=T,quote=F,sep="\t")
#======================================================================================================================================
#edited by NJ/CJ to accommodate input from gDNA barcode pipeline
#======================================================================================================================================
#choose the analyzed folder which contains each of your individual samples after Step One
homeDirectory <- '/Users/jess/Dropbox (RajLab)/Shared_JessL/Data/WM989/barcodeDNASeq/20230726/repo/Experiment/analyzed/exp2/'
outputDirectory <- '/Users/jess/Dropbox (RajLab)/Shared_JessL/Data/WM989/barcodeDNASeq/20230726/repo/Experiment/analyzed/exp2/'
library(stringdist)
library(gridExtra)
library(ggplot2)
library(dplyr)
library(tidyverse)
library(spgs)
#import each sample table with barcodes and UMI counts into R for modificaiton
sampleFolders <- list.files(path = homeDirectory, pattern = '*UMICountsOnly', recursive = TRUE)
sampleTables <- list(rep("NA", length(sampleFolders)))
for (i in 1:length(sampleFolders)) {
sampleTable = read.table(paste0(homeDirectory, sampleFolders[i]), header = FALSE, sep = "\t")
sampleTables[[i]] <- sampleTable
}
sampleNames <- dirname(dirname(sampleFolders))
#convert each sample table into the format expected by the side reaction pipeline
sampleSCTables <- list(rep("NA", length(sampleFolders)))
for (i in 1:length(sampleFolders)) {
sampleSCTable <-
as_tibble(read.table(paste0(homeDirectory, sampleFolders[i]), stringsAsFactors = F)) %>% dplyr::rename(BC = V1, UMI = V2) %>%
rowwise() %>% mutate(BC = reverseComplement(BC, case = "as is")) %>% ungroup() %>%
mutate(BC50 = substring(BC, 1, 50), BC40 = substring(BC, 1, 40), BC30a = substring(BC, 1, 30), BC30b = substring(BC, 1, 30)) %>%
mutate(sampleNum = sampleNames[i])
sampleSCTables[[i]] <- sampleSCTable
}
sampleSCTableAll <- list()
#concatenate all sample tables into a single experiment table to feed into starcode
for(i in 1:length(sampleFolders)) {
sampleSCTableTemp = sampleSCTables[[i]] %>% mutate(sampleNum = sampleNames[i])
if (is.null(dim(sampleSCTableAll))) {sampleSCTableAll = sampleSCTableTemp}
else {sampleSCTableAll = bind_rows(sampleSCTableAll, sampleSCTableTemp)}
}
#reformat the columns into the format expected by the side reaction pipeine
sampleSCTableAll <- sampleSCTableAll %>% add_column(cellID = "dummy", .before = "BC")
sampleSCTableAll <- sampleSCTableAll %>% relocate(UMI, .before = BC)
sampleSCTableAll$UMI <- as.character(sampleSCTableAll$UMI)
write.table(sampleSCTableAll, file= paste0(outputDirectory,'stepTwoCellIDUMIBarcodes.txt'),row.names=F,col.names=T,quote=F,sep="\t")
write.table(sampleSCTableAll[,4], file= paste0(outputDirectory,'stepTwoBarcodes50.txt'),row.names=F,col.names=F,quote=F,sep="\t")
write.table(sampleSCTableAll[,5], file= paste0(outputDirectory,'stepTwoBarcodes40.txt'),row.names=F,col.names=F,quote=F,sep="\t")
write.table(sampleSCTableAll[,6], file= paste0(outputDirectory,'stepTwoBarcodes30.txt'),row.names=F,col.names=F,quote=F,sep="\t")
#for checking LV distance histogram for an individual sample
barcodes = unique(sampleSCTableAll$BC)
set.seed(2059)
subsample1 = sample(barcodes, 1000)
subsample2 = sample(barcodes, 1000)
subsample3 = sample(barcodes, 1000)
BarcodesLv1 = as.integer(stringdistmatrix(subsample1, method = "lv"))
BarcodesLv2 = as.integer(stringdistmatrix(subsample2, method = "lv"))
BarcodesLv3 = as.integer(stringdistmatrix(subsample3, method = "lv"))
lBarcodesLv = length(BarcodesLv1)
BarcodesLv = tibble(
lvdist = c(BarcodesLv1, BarcodesLv2, BarcodesLv3),
subsamNum = c(rep("subsamping1", lBarcodesLv), rep("subsamping2", lBarcodesLv), rep("subsamping3", lBarcodesLv)))
BarcodesLvHist <- BarcodesLv %>% group_by(subsamNum, lvdist) %>% summarise(length(lvdist)) %>%
group_by(subsamNum) %>% mutate(totalNum = sum(`length(lvdist)`), fracLvDist = `length(lvdist)`/totalNum)
BarcodesLvHistPlot <- ggplot(BarcodesLvHist, aes(lvdist, fracLvDist)) +
geom_bar(width = 0.5, stat = 'identity') +
facet_wrap(facets = vars(subsamNum)) +
theme_classic()
ggsave(filename = paste0(outputDirectory, "lvDistancePlot.pdf"), plot = BarcodesLvHistPlot, height = 5, width = 5)
#use bc40 for overlap analysis
barcode_data <- sampleSCTableAll[,c(2,5,8)]
condition_names <- unique(barcode_data$sampleNum)
overlap_results <- map(condition_names, function(cond1) {
map_df(setdiff(condition_names, cond1), function(cond2) {
common_barcodes <- intersect(
barcode_data$BC40[barcode_data$sampleNum == cond1],
barcode_data$BC40[barcode_data$sampleNum == cond2]
)
unique_barcodes_cond1 <- setdiff(
barcode_data$BC40[barcode_data$sampleNum == cond1],
common_barcodes
)
unique_barcodes_cond2 <- setdiff(
barcode_data$BC40[barcode_data$sampleNum == cond2],
common_barcodes
)
tibble(
Condition1 = cond1,
Condition2 = cond2,
OverlappingBarcodes = common_barcodes,
NumOverlappingBarcodes = length(common_barcodes),
NumUniqueBarcodesCondition1 = length(unique_barcodes_cond1),
NumUniqueBarcodesCondition2 = length(unique_barcodes_cond2)
)
})
})
# Flatten the results into a single data frame
overlap_results <- bind_rows(overlap_results)
ggplot(overlap_results, aes(x = Condition1, y = NumOverlappingBarcodes, fill = Condition2)) +
geom_bar(stat = "identity", position = "dodge") +
labs(title = "Number of Overlapping Barcodes", x = "Condition 1", y = "Number of Barcodes") +
theme_minimal()
ggplot(overlap_results, aes(x = Condition1, y = NumUniqueBarcodesCondition2, fill = Condition2)) +
geom_bar(stat = "identity", position = "dodge") +
labs(title = "Number of Unique Barcodes in Condition 2", x = "Condition 1", y = "Number of Barcodes") +
theme_minimal()
ggplot(overlap_results, aes(x = Condition1, y = Condition2, fill = NumOverlappingBarcodes)) +
geom_tile() +
labs(title = "Heatmap of Overlapping Barcodes", x = "Condition 1", y = "Condition 2", fill = "Number of Barcodes") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
write.table(overlap_results, file= paste0(outputDirectory,'overlap_result.txt'),row.names=F,col.names=T,quote=F,sep="\t")
#======================================================================================================================================
#edited by NJ/CJ to accommodate input from gDNA barcode pipeline
#======================================================================================================================================
#choose the analyzed folder which contains each of your individual samples after Step One
homeDirectory <- '/Users/jess/Dropbox (RajLab)/Shared_JessL/Data/WM989/barcodeDNASeq/20230726/repo/Experiment/analyzed/exp3/'
outputDirectory <- '/Users/jess/Dropbox (RajLab)/Shared_JessL/Data/WM989/barcodeDNASeq/20230726/repo/Experiment/analyzed/exp3/'
library(stringdist)
library(gridExtra)
library(ggplot2)
library(dplyr)
library(tidyverse)
library(spgs)
#import each sample table with barcodes and UMI counts into R for modificaiton
sampleFolders <- list.files(path = homeDirectory, pattern = '*UMICountsOnly', recursive = TRUE)
sampleTables <- list(rep("NA", length(sampleFolders)))
for (i in 1:length(sampleFolders)) {
sampleTable = read.table(paste0(homeDirectory, sampleFolders[i]), header = FALSE, sep = "\t")
sampleTables[[i]] <- sampleTable
}
sampleNames <- dirname(dirname(sampleFolders))
#convert each sample table into the format expected by the side reaction pipeline
sampleSCTables <- list(rep("NA", length(sampleFolders)))
for (i in 1:length(sampleFolders)) {
sampleSCTable <-
as_tibble(read.table(paste0(homeDirectory, sampleFolders[i]), stringsAsFactors = F)) %>% dplyr::rename(BC = V1, UMI = V2) %>%
rowwise() %>% mutate(BC = reverseComplement(BC, case = "as is")) %>% ungroup() %>%
mutate(BC50 = substring(BC, 1, 50), BC40 = substring(BC, 1, 40), BC30a = substring(BC, 1, 30), BC30b = substring(BC, 1, 30)) %>%
mutate(sampleNum = sampleNames[i])
sampleSCTables[[i]] <- sampleSCTable
}
sampleSCTableAll <- list()
#concatenate all sample tables into a single experiment table to feed into starcode
for(i in 1:length(sampleFolders)) {
sampleSCTableTemp = sampleSCTables[[i]] %>% mutate(sampleNum = sampleNames[i])
if (is.null(dim(sampleSCTableAll))) {sampleSCTableAll = sampleSCTableTemp}
else {sampleSCTableAll = bind_rows(sampleSCTableAll, sampleSCTableTemp)}
}
#reformat the columns into the format expected by the side reaction pipeine
sampleSCTableAll <- sampleSCTableAll %>% add_column(cellID = "dummy", .before = "BC")
sampleSCTableAll <- sampleSCTableAll %>% relocate(UMI, .before = BC)
sampleSCTableAll$UMI <- as.character(sampleSCTableAll$UMI)
write.table(sampleSCTableAll, file= paste0(outputDirectory,'stepTwoCellIDUMIBarcodes.txt'),row.names=F,col.names=T,quote=F,sep="\t")
write.table(sampleSCTableAll[,4], file= paste0(outputDirectory,'stepTwoBarcodes50.txt'),row.names=F,col.names=F,quote=F,sep="\t")
write.table(sampleSCTableAll[,5], file= paste0(outputDirectory,'stepTwoBarcodes40.txt'),row.names=F,col.names=F,quote=F,sep="\t")
write.table(sampleSCTableAll[,6], file= paste0(outputDirectory,'stepTwoBarcodes30.txt'),row.names=F,col.names=F,quote=F,sep="\t")
#for checking LV distance histogram for an individual sample
barcodes = unique(sampleSCTableAll$BC)
set.seed(2059)
subsample1 = sample(barcodes, 1000)
#choose the analyzed folder which contains each of your individual samples after Step One
homeDirectory <- '/Users/jess/Dropbox (RajLab)/Shared_JessL/Data/WM989/barcodeDNASeq/20230726/repo/Experiment/analyzed/exp3/'
outputDirectory <- '/Users/jess/Dropbox (RajLab)/Shared_JessL/Data/WM989/barcodeDNASeq/20230726/repo/Experiment/analyzed/exp3/'
barcode_data <- sampleSCTableAll[,c(2,5,8)]
condition_names <- unique(barcode_data$sampleNum)
overlap_results <- map(condition_names, function(cond1) {
map_df(setdiff(condition_names, cond1), function(cond2) {
common_barcodes <- intersect(
barcode_data$BC40[barcode_data$sampleNum == cond1],
barcode_data$BC40[barcode_data$sampleNum == cond2]
)
unique_barcodes_cond1 <- setdiff(
barcode_data$BC40[barcode_data$sampleNum == cond1],
common_barcodes
)
unique_barcodes_cond2 <- setdiff(
barcode_data$BC40[barcode_data$sampleNum == cond2],
common_barcodes
)
tibble(
Condition1 = cond1,
Condition2 = cond2,
OverlappingBarcodes = common_barcodes,
NumOverlappingBarcodes = length(common_barcodes),
NumUniqueBarcodesCondition1 = length(unique_barcodes_cond1),
NumUniqueBarcodesCondition2 = length(unique_barcodes_cond2)
)
})
})
# Flatten the results into a single data frame
overlap_results <- bind_rows(overlap_results)
ggplot(overlap_results, aes(x = Condition1, y = NumOverlappingBarcodes, fill = Condition2)) +
geom_bar(stat = "identity", position = "dodge") +
labs(title = "Number of Overlapping Barcodes", x = "Condition 1", y = "Number of Barcodes") +
theme_minimal()
ggplot(overlap_results, aes(x = Condition1, y = NumUniqueBarcodesCondition2, fill = Condition2)) +
geom_bar(stat = "identity", position = "dodge") +
labs(title = "Number of Unique Barcodes in Condition 2", x = "Condition 1", y = "Number of Barcodes") +
theme_minimal()
ggplot(overlap_results, aes(x = Condition1, y = Condition2, fill = NumOverlappingBarcodes)) +
geom_tile() +
labs(title = "Heatmap of Overlapping Barcodes", x = "Condition 1", y = "Condition 2", fill = "Number of Barcodes") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
write.table(overlap_results, file= paste0(outputDirectory,'overlap_result.txt'),row.names=F,col.names=T,quote=F,sep="\t")
#choose the analyzed folder which contains each of your individual samples after Step One
homeDirectory <- '/Users/jess/Dropbox (RajLab)/Shared_JessL/Data/WM989/barcodeDNASeq/20230726/repo/Experiment/analyzed/exp4/'
outputDirectory <- '/Users/jess/Dropbox (RajLab)/Shared_JessL/Data/WM989/barcodeDNASeq/20230726/repo/Experiment/analyzed/exp4/'
#use bc40 for overlap analysis
barcode_data <- sampleSCTableAll[,c(2,5,8)]
condition_names <- unique(barcode_data$sampleNum)
overlap_results <- map(condition_names, function(cond1) {
map_df(setdiff(condition_names, cond1), function(cond2) {
common_barcodes <- intersect(
barcode_data$BC40[barcode_data$sampleNum == cond1],
barcode_data$BC40[barcode_data$sampleNum == cond2]
)
unique_barcodes_cond1 <- setdiff(
barcode_data$BC40[barcode_data$sampleNum == cond1],
common_barcodes
)
unique_barcodes_cond2 <- setdiff(
barcode_data$BC40[barcode_data$sampleNum == cond2],
common_barcodes
)
tibble(
Condition1 = cond1,
Condition2 = cond2,
OverlappingBarcodes = common_barcodes,
NumOverlappingBarcodes = length(common_barcodes),
NumUniqueBarcodesCondition1 = length(unique_barcodes_cond1),
NumUniqueBarcodesCondition2 = length(unique_barcodes_cond2)
)
})
})
# Flatten the results into a single data frame
overlap_results <- bind_rows(overlap_results)
ggplot(overlap_results, aes(x = Condition1, y = NumOverlappingBarcodes, fill = Condition2)) +
geom_bar(stat = "identity", position = "dodge") +
labs(title = "Number of Overlapping Barcodes", x = "Condition 1", y = "Number of Barcodes") +
theme_minimal()
ggplot(overlap_results, aes(x = Condition1, y = NumUniqueBarcodesCondition2, fill = Condition2)) +
geom_bar(stat = "identity", position = "dodge") +
labs(title = "Number of Unique Barcodes in Condition 2", x = "Condition 1", y = "Number of Barcodes") +
theme_minimal()
ggplot(overlap_results, aes(x = Condition1, y = Condition2, fill = NumOverlappingBarcodes)) +
geom_tile() +
labs(title = "Heatmap of Overlapping Barcodes", x = "Condition 1", y = "Condition 2", fill = "Number of Barcodes") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
write.table(overlap_results, file= paste0(outputDirectory,'overlap_result.txt'),row.names=F,col.names=T,quote=F,sep="\t")
#choose the analyzed folder which contains each of your individual samples after Step One
homeDirectory <- '/Users/jess/Dropbox (RajLab)/Shared_JessL/Data/WM989/barcodeDNASeq/20230726/repo/Experiment/analyzed/exp5/'
outputDirectory <- '/Users/jess/Dropbox (RajLab)/Shared_JessL/Data/WM989/barcodeDNASeq/20230726/repo/Experiment/analyzed/exp5/'
#use bc40 for overlap analysis
barcode_data <- sampleSCTableAll[,c(2,5,8)]
condition_names <- unique(barcode_data$sampleNum)
overlap_results <- map(condition_names, function(cond1) {
map_df(setdiff(condition_names, cond1), function(cond2) {
common_barcodes <- intersect(
barcode_data$BC40[barcode_data$sampleNum == cond1],
barcode_data$BC40[barcode_data$sampleNum == cond2]
)
unique_barcodes_cond1 <- setdiff(
barcode_data$BC40[barcode_data$sampleNum == cond1],
common_barcodes
)
unique_barcodes_cond2 <- setdiff(
barcode_data$BC40[barcode_data$sampleNum == cond2],
common_barcodes
)
tibble(
Condition1 = cond1,
Condition2 = cond2,
OverlappingBarcodes = common_barcodes,
NumOverlappingBarcodes = length(common_barcodes),
NumUniqueBarcodesCondition1 = length(unique_barcodes_cond1),
NumUniqueBarcodesCondition2 = length(unique_barcodes_cond2)
)
})
})
# Flatten the results into a single data frame
overlap_results <- bind_rows(overlap_results)
ggplot(overlap_results, aes(x = Condition1, y = NumOverlappingBarcodes, fill = Condition2)) +
geom_bar(stat = "identity", position = "dodge") +
labs(title = "Number of Overlapping Barcodes", x = "Condition 1", y = "Number of Barcodes") +
theme_minimal()
ggplot(overlap_results, aes(x = Condition1, y = NumUniqueBarcodesCondition2, fill = Condition2)) +
geom_bar(stat = "identity", position = "dodge") +
labs(title = "Number of Unique Barcodes in Condition 2", x = "Condition 1", y = "Number of Barcodes") +
theme_minimal()
ggplot(overlap_results, aes(x = Condition1, y = Condition2, fill = NumOverlappingBarcodes)) +
geom_tile() +
labs(title = "Heatmap of Overlapping Barcodes", x = "Condition 1", y = "Condition 2", fill = "Number of Barcodes") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
write.table(overlap_results, file= paste0(outputDirectory,'overlap_result.txt'),row.names=F,col.names=T,quote=F,sep="\t")
#choose the analyzed folder which contains each of your individual samples after Step One
homeDirectory <- '/Users/jess/Dropbox (RajLab)/Shared_JessL/Data/WM989/barcodeDNASeq/20230726/repo/Experiment/analyzed/exp6/'
outputDirectory <- '/Users/jess/Dropbox (RajLab)/Shared_JessL/Data/WM989/barcodeDNASeq/20230726/repo/Experiment/analyzed/exp6/'
#use bc40 for overlap analysis
barcode_data <- sampleSCTableAll[,c(2,5,8)]
condition_names <- unique(barcode_data$sampleNum)
overlap_results <- map(condition_names, function(cond1) {
map_df(setdiff(condition_names, cond1), function(cond2) {
common_barcodes <- intersect(
barcode_data$BC40[barcode_data$sampleNum == cond1],
barcode_data$BC40[barcode_data$sampleNum == cond2]
)
unique_barcodes_cond1 <- setdiff(
barcode_data$BC40[barcode_data$sampleNum == cond1],
common_barcodes
)
unique_barcodes_cond2 <- setdiff(
barcode_data$BC40[barcode_data$sampleNum == cond2],
common_barcodes
)
tibble(
Condition1 = cond1,
Condition2 = cond2,
OverlappingBarcodes = common_barcodes,
NumOverlappingBarcodes = length(common_barcodes),
NumUniqueBarcodesCondition1 = length(unique_barcodes_cond1),
NumUniqueBarcodesCondition2 = length(unique_barcodes_cond2)
)
})
})
# Flatten the results into a single data frame
overlap_results <- bind_rows(overlap_results)
ggplot(overlap_results, aes(x = Condition1, y = NumOverlappingBarcodes, fill = Condition2)) +
geom_bar(stat = "identity", position = "dodge") +
labs(title = "Number of Overlapping Barcodes", x = "Condition 1", y = "Number of Barcodes") +
theme_minimal()
ggplot(overlap_results, aes(x = Condition1, y = NumUniqueBarcodesCondition2, fill = Condition2)) +
geom_bar(stat = "identity", position = "dodge") +
labs(title = "Number of Unique Barcodes in Condition 2", x = "Condition 1", y = "Number of Barcodes") +
theme_minimal()
ggplot(overlap_results, aes(x = Condition1, y = Condition2, fill = NumOverlappingBarcodes)) +
geom_tile() +
labs(title = "Heatmap of Overlapping Barcodes", x = "Condition 1", y = "Condition 2", fill = "Number of Barcodes") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
write.table(overlap_results, file= paste0(outputDirectory,'overlap_result.txt'),row.names=F,col.names=T,quote=F,sep="\t")
#choose the analyzed folder which contains each of your individual samples after Step One
homeDirectory <- '/Users/jess/Dropbox (RajLab)/Shared_JessL/Data/WM989/barcodeDNASeq/20230726/repo/Experiment/analyzed/exp7/'
outputDirectory <- '/Users/jess/Dropbox (RajLab)/Shared_JessL/Data/WM989/barcodeDNASeq/20230726/repo/Experiment/analyzed/exp7/'
#use bc40 for overlap analysis
barcode_data <- sampleSCTableAll[,c(2,5,8)]
condition_names <- unique(barcode_data$sampleNum)
overlap_results <- map(condition_names, function(cond1) {
map_df(setdiff(condition_names, cond1), function(cond2) {
common_barcodes <- intersect(
barcode_data$BC40[barcode_data$sampleNum == cond1],
barcode_data$BC40[barcode_data$sampleNum == cond2]
)
unique_barcodes_cond1 <- setdiff(
barcode_data$BC40[barcode_data$sampleNum == cond1],
common_barcodes
)
unique_barcodes_cond2 <- setdiff(
barcode_data$BC40[barcode_data$sampleNum == cond2],
common_barcodes
)
tibble(
Condition1 = cond1,
Condition2 = cond2,
OverlappingBarcodes = common_barcodes,
NumOverlappingBarcodes = length(common_barcodes),
NumUniqueBarcodesCondition1 = length(unique_barcodes_cond1),
NumUniqueBarcodesCondition2 = length(unique_barcodes_cond2)
)
})
})
# Flatten the results into a single data frame
overlap_results <- bind_rows(overlap_results)
ggplot(overlap_results, aes(x = Condition1, y = NumOverlappingBarcodes, fill = Condition2)) +
geom_bar(stat = "identity", position = "dodge") +
labs(title = "Number of Overlapping Barcodes", x = "Condition 1", y = "Number of Barcodes") +
theme_minimal()
ggplot(overlap_results, aes(x = Condition1, y = NumUniqueBarcodesCondition2, fill = Condition2)) +
geom_bar(stat = "identity", position = "dodge") +
labs(title = "Number of Unique Barcodes in Condition 2", x = "Condition 1", y = "Number of Barcodes") +
theme_minimal()
ggplot(overlap_results, aes(x = Condition1, y = Condition2, fill = NumOverlappingBarcodes)) +
geom_tile() +
labs(title = "Heatmap of Overlapping Barcodes", x = "Condition 1", y = "Condition 2", fill = "Number of Barcodes") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
write.table(overlap_results, file= paste0(outputDirectory,'overlap_result.txt'),row.names=F,col.names=T,quote=F,sep="\t")
# Create sets
set1 <- c("A", "B", "C", "D")
set2 <- c("C", "D", "E", "F")
set3 <- c("D", "E", "F", "G")
# Create Venn diagram
venn.plot <- venn.diagram(
x = list(set1 = set1, set2 = set2, set3 = set3),
category.names = c("Set 1", "Set 2", "Set 3"),
filename = NULL
)
# Display the Venn diagram
grid.draw(venn.plot)
# Create Venn diagram
venn.plot <- venn.diagram(
x = list(set1 = set1, set2 = set2, set3 = set3),
category.names = c("Set 1", "Set 2"),
filename = NULL
)
# Display the Venn diagram
grid.draw(venn.plot)
dev.off(
)
# Create Venn diagram
venn.plot <- venn.diagram(
x = list(set1 = set1, set2 = set2, set3 = set3),
category.names = c("Set 1", "Set 2"),
filename = NULL
)
# Create Venn diagram
venn.plot <- venn.diagram(
x = list(set1 = set1, set2 = set2),
category.names = c("Set 1", "Set 2"),
filename = NULL
)
# Display the Venn diagram
grid.draw(venn.plot)
View(overlap_results)
View(sampleSCTableAll)
sample10 <- dplyr::filter(sampleSCTableAll, sampleNum == "JL_AT_10")
View(sample10)
View(BarcodesLvHist)
